---
- name: Install Trivy RPM
  shell: |
    TRIVY_VERSION=$(curl -s https://api.github.com/repos/aquasecurity/trivy/releases/latest | jq -r .tag_name | sed 's/v//')
    dnf install -y "https://github.com/aquasecurity/trivy/releases/download/v${TRIVY_VERSION}/trivy_${TRIVY_VERSION}_Linux-64bit.rpm"
  args:
    creates: /usr/local/bin/trivy

- name: Install Checkov (IaC Scanner)
  pip:
    name: checkov
    state: present

- name: Verify Trivy Installation
  command: trivy --version
  register: trivy_version
  changed_when: false

- name: Verify Checkov Installation
  command: checkov --version
  register: checkov_version
  changed_when: false

- name: Display Security Tool Versions
  debug:
    msg:
      - "Trivy:   {{ trivy_version.stdout }}"
      - "Checkov: {{ checkov_version.stdout }}"
