---
# ───────────────────────────────────────────────────────────────────
# Playbook: Install & Configure Spring PetClinic Infrastructure
# ───────────────────────────────────────────────────────────────────
# Inventory is auto-generated by Terraform (local_file.ansible_inventory)
# Run with: ansible-playbook playbooks/install-tools.yml
# ───────────────────────────────────────────────────────────────────

# ─── Play 1: Core Tools on ALL Nodes ─────────────────────────────
- name: Install Core Tools on All Nodes
  hosts: all_nodes
  gather_facts: yes

  pre_tasks:
    - name: Display Target Node Info
      debug:
        msg: "Configuring {{ inventory_hostname }} ({{ ansible_distribution }} {{ ansible_distribution_version }})"

    - name: Wait for SSH to become available
      wait_for_connection:
        delay: 5
        timeout: 120

  roles:
    - java
    - docker
    - awscli

# ─── Play 2: Jenkins Master Configuration ────────────────────────
- name: Configure Jenkins Master
  hosts: jenkins_master
  gather_facts: no

  roles:
    - jenkins

# ─── Play 3: Build & Deploy Tools on Worker Nodes ────────────────
- name: Install Build & Deploy Tools on Worker Nodes
  hosts: build_agents
  gather_facts: no

  roles:
    - maven
    - kubectl
    - helm

# ─── Play 4: SonarQube Stack Deployment ──────────────────────────
- name: Deploy SonarQube Stack
  hosts: sonarqube
  gather_facts: no

  roles:
    - sonarqube

# ─── Play 5: DevSecOps Tools on CI/CD Nodes ──────────────────────
- name: Install DevSecOps Tools
  hosts: devops_tools
  gather_facts: no

  roles:
    - security_tools
